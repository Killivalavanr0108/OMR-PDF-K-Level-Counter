<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K-Level Counter</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table, th, td { border: 1px solid #333; border-collapse: collapse; padding: 8px; text-align: center; }
  table { width: 100%; margin-top: 20px; }
</style>
</head>
<body>

<h1>K-Level Counter</h1>
<input type="file" id="excelFile" accept=".xlsx, .xls" />
<button onclick="processExcel()">Process</button>

<div id="results"></div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<script>
let data = [];

function processExcel() {
    const fileInput = document.getElementById('excelFile');
    if (!fileInput.files.length) { alert("Please select an Excel file."); return; }

    const reader = new FileReader();
    reader.onload = function(e) {
        const dataBinary = new Uint8Array(e.target.result);
        const workbook = XLSX.read(dataBinary, {type: "array"});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        data = XLSX.utils.sheet_to_json(firstSheet, {defval: 0});
        if(data.length === 0) { alert("Excel file is empty or invalid."); return; }
        displayResults();
    };
    reader.readAsArrayBuffer(fileInput.files[0]);
}

function displayResults() {
    const resultsDiv = document.getElementById('results');
    let html = "";

    const kLevels = ["K1","K2","K3","K4","K5","K6"];
    const totalStudents = data.length;

    // Student Details Table
    const columns = ["S.No","Name","Reg.no","Subject","Subject Code"].concat(kLevels);
    html += "<h3>Student Details</h3><table><tr>";
    columns.forEach(col => html += `<th>${col}</th>`);
    html += "</tr>";
    data.forEach(student => {
        html += "<tr>";
        columns.forEach(col => html += `<td>${student[col] || 0}</td>`);
        html += "</tr>";
    });
    html += "</table>";

    // Calculate SUM per K-Level
    let kTotals = {};
    kLevels.forEach(k => kTotals[k] = 0);
    data.forEach(student => {
        kLevels.forEach(k => kTotals[k] += Number(student[k] || 0));
    });

    // Display SUM per K-Level
    html += "<h3>K-Level Totals (SUM)</h3><table><tr>";
    kLevels.forEach(k => html += `<th>${k}</th>`);
    html += "</tr><tr>";
    kLevels.forEach(k => html += `<td>${kTotals[k]}</td>`);
    html += "</tr></table>";

    // Calculate AVERAGE per K-Level (SUM / total students)
    html += "<h3>K-Level Average (SUM / Total Students)</h3><table><tr>";
    kLevels.forEach(k => html += `<th>${k}</th>`);
    html += "</tr><tr>";
    kLevels.forEach(k => {
        const avg = totalStudents ? (kTotals[k] / totalStudents).toFixed(2) : 0;
        html += `<td>${avg}</td>`;
    });
    html += "</tr></table>";

    resultsDiv.innerHTML = html;
}
</script>

</body>
</html>
